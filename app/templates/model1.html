<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% if title %}
        <title>Lessons from Data 200 - {{title}}</title>
    {% else %}
        <title>Lessons from Data 200</title>
    {% endif %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
        .draggable { cursor: move; margin: 5px; padding: 5px; border: 1px solid #ccc; display: inline-block;}
        #selected-features { min-height: 100px; border: 1px solid #ccc; padding: 10px; }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <div class="container px-4 py-5" id="model">
        <h1 style="text-align: center;">{{ title }}</h1>
        
        <div class="row">
            <div class="col-md-6">
                <h3>Available features:</h3>
                <div id="available-features"></div>
            </div>

            <div class="col-md-6">
                <h3>Selected features:</h3>
                <div id="selected-features"></div>
            </div>
        </div>

        <div class="table-responsive">
            {{ data|safe }}
        </div>

        <button id="train-model" class="btn btn-primary mt-3">Train model</button>

        <div id="result" class="mt-3">
            <h3>RMSE: <span id="rmse"></span></h3>
        </div>

    </div>

    <script>
        $(function() {
            // Example columns
            const columns = {{ data_columns|tojson }};
            const availableFeaturesDiv = $('#available-features');

            columns.forEach(column => {
                availableFeaturesDiv.append(`<div class="draggable" data-feature="${column}">${column}</div>`);
            });

            $('.draggable').draggable({
                helper: 'clone'
            });

            $('#selected-features').droppable({
                accept: '.draggable',
                drop: function(event, ui) {
                    const feature = ui.helper.data('feature');
                    $(this).append(`<div class="draggable" data-feature="${feature}">${feature}</div>`);
                }
            });

            $('#train-model').click(function() {
                const selectedFeatures = [];
                $('#selected-features .draggable').each(function() {
                    selectedFeatures.push($(this).data('feature'));
                });

                $.ajax({
                    url: '/train',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ features: selectedFeatures }),
                    success: function(response) {
                        $('#rmse').text(response.rmse);
                    }
                });
            });
        });
    </script>
</body>
</html>